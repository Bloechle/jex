<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jex Framework Import Test</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">

<!-- Header -->
<div class="max-w-4xl mx-auto mb-8">
    <div class="bg-white rounded-xl shadow-sm border p-6">
        <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                <span class="text-white font-bold">J</span>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Jex Framework Import Test</h1>
                <p class="text-gray-500">Testing ES6 module imports and MIME types</p>
            </div>
        </div>

        <div id="overallStatus" class="p-4 rounded-lg bg-gray-50 text-gray-600">
            üîÑ Initializing tests...
        </div>
    </div>
</div>

<!-- Test Results -->
<div class="max-w-4xl mx-auto space-y-4">
    <!-- Individual File Tests -->
    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
        <div class="bg-gray-50 px-6 py-3 border-b">
            <h2 class="font-semibold text-gray-900 flex items-center gap-2">
                <i data-lucide="file-text" class="w-5 h-5"></i>
                Individual File Import Tests
            </h2>
        </div>
        <div id="fileTests" class="p-6">
            <!-- Test results will be inserted here -->
        </div>
    </div>

    <!-- Package Test -->
    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
        <div class="bg-gray-50 px-6 py-3 border-b">
            <h2 class="font-semibold text-gray-900 flex items-center gap-2">
                <i data-lucide="package" class="w-5 h-5"></i>
                JexPackage Integration Test
            </h2>
        </div>
        <div id="packageTest" class="p-6">
            <div class="text-gray-500">Waiting for individual tests to complete...</div>
        </div>
    </div>

    <!-- Functionality Test -->
    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
        <div class="bg-gray-50 px-6 py-3 border-b">
            <h2 class="font-semibold text-gray-900 flex items-center gap-2">
                <i data-lucide="play-circle" class="w-5 h-5"></i>
                Functionality Test
            </h2>
        </div>
        <div id="functionalityTest" class="p-6">
            <div class="text-gray-500">Waiting for imports to complete...</div>
        </div>
    </div>

    <!-- Debug Info -->
    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
        <div class="bg-gray-50 px-6 py-3 border-b">
            <h2 class="font-semibold text-gray-900 flex items-center gap-2">
                <i data-lucide="bug" class="w-5 h-5"></i>
                Debug Information
            </h2>
        </div>
        <div id="debugInfo" class="p-6 font-mono text-sm">
            <!-- Debug info will be inserted here -->
        </div>
    </div>
</div>

<script type="module">
    // Test state
    let testResults = {
        files: {},
        package: null,
        functionality: null,
        totalTests: 0,
        passedTests: 0
    };

    // DOM elements
    const overallStatus = document.getElementById('overallStatus');
    const fileTests = document.getElementById('fileTests');
    const packageTest = document.getElementById('packageTest');
    const functionalityTest = document.getElementById('functionalityTest');
    const debugInfo = document.getElementById('debugInfo');

    // Initialize Lucide icons
    lucide.createIcons();

    // Helper functions
    function updateOverallStatus() {
        const percentage = testResults.totalTests > 0 ? Math.round((testResults.passedTests / testResults.totalTests) * 100) : 0;

        if (testResults.totalTests === 0) {
            overallStatus.innerHTML = 'üîÑ Running tests...';
            overallStatus.className = 'p-4 rounded-lg bg-blue-50 text-blue-700';
        } else if (testResults.passedTests === testResults.totalTests) {
            overallStatus.innerHTML = `‚úÖ All tests passed! (${testResults.passedTests}/${testResults.totalTests})`;
            overallStatus.className = 'p-4 rounded-lg bg-green-50 text-green-700';
        } else {
            overallStatus.innerHTML = `‚ö†Ô∏è ${testResults.passedTests}/${testResults.totalTests} tests passed (${percentage}%)`;
            overallStatus.className = 'p-4 rounded-lg bg-yellow-50 text-yellow-700';
        }
    }

    function logDebug(message) {
        console.log(message);
        const timestamp = new Date().toLocaleTimeString();
        debugInfo.innerHTML += `<div class="text-gray-600 mb-1">[${timestamp}] ${message}</div>`;
    }

    function createTestResult(name, status, error = null) {
        const statusClass = status === 'success' ? 'bg-green-50 text-green-700 border-green-200' :
            status === 'error' ? 'bg-red-50 text-red-700 border-red-200' :
                'bg-yellow-50 text-yellow-700 border-yellow-200';

        const icon = status === 'success' ? 'check-circle' :
            status === 'error' ? 'x-circle' : 'clock';

        return `
                <div class="flex items-start gap-3 p-4 border rounded-lg ${statusClass} mb-3">
                    <i data-lucide="${icon}" class="w-5 h-5 mt-0.5 flex-shrink-0"></i>
                    <div class="flex-1">
                        <div class="font-medium">${name}</div>
                        ${error ? `<div class="text-sm mt-1 font-mono bg-white/50 p-2 rounded">${error}</div>` : ''}
                    </div>
                </div>
            `;
    }

    // Test individual file imports
    async function testFileImport(filename, displayName) {
        logDebug(`Testing import: ${filename}`);
        testResults.totalTests++;

        try {
            const startTime = performance.now();
            const module = await import(`./${filename}`);
            const loadTime = Math.round(performance.now() - startTime);

            testResults.files[filename] = { status: 'success', module, loadTime };
            testResults.passedTests++;

            logDebug(`‚úÖ ${filename} loaded successfully (${loadTime}ms)`);

            return createTestResult(
                `${displayName} (${loadTime}ms)`,
                'success'
            );

        } catch (error) {
            testResults.files[filename] = { status: 'error', error: error.message };

            logDebug(`‚ùå ${filename} failed: ${error.message}`);

            return createTestResult(
                displayName,
                'error',
                error.message
            );
        }
    }

    // Test package integration
    async function testPackageIntegration() {
        logDebug('Testing JexPackage integration...');
        testResults.totalTests++;

        try {
            if (!testResults.files['JexPackage.js'] || testResults.files['JexPackage.js'].status !== 'success') {
                throw new Error('JexPackage.js failed to load');
            }

            const jexPackageModule = testResults.files['JexPackage.js'].module;
            const { default: jexPackage, jex, logger, toast, inspector } = jexPackageModule;

            // Test package initialization
            if (jexPackage && typeof jexPackage.isReady === 'function') {
                const isReady = jexPackage.isReady();
                logDebug(`JexPackage ready status: ${isReady}`);

                testResults.package = { status: 'success', isReady };
                testResults.passedTests++;

                return createTestResult(
                    `JexPackage Integration (Ready: ${isReady})`,
                    'success'
                );
            } else {
                throw new Error('JexPackage does not have expected structure');
            }

        } catch (error) {
            testResults.package = { status: 'error', error: error.message };
            logDebug(`‚ùå Package integration failed: ${error.message}`);

            return createTestResult(
                'JexPackage Integration',
                'error',
                error.message
            );
        }
    }

    // Test basic functionality
    async function testFunctionality() {
        logDebug('Testing basic functionality...');
        testResults.totalTests++;

        try {
            if (!testResults.package || testResults.package.status !== 'success') {
                throw new Error('Package integration must pass first');
            }

            const jexPackageModule = testResults.files['JexPackage.js'].module;
            const { default: jexPackage, jex } = jexPackageModule;

            // Test DOM manipulation
            const testDiv = document.createElement('div');
            testDiv.id = 'jexTest';
            testDiv.innerHTML = 'Test Element';
            document.body.appendChild(testDiv);

            // Test jex functionality
            if (jex && typeof jex.$ === 'function') {
                const element = jex.$('jexTest');
                if (element && typeof element.text === 'function') {
                    element.text('Modified by Jex');

                    if (testDiv.textContent === 'Modified by Jex') {
                        logDebug('‚úÖ DOM manipulation working');
                        testResults.functionality = { status: 'success' };
                        testResults.passedTests++;

                        // Clean up
                        testDiv.remove();

                        return createTestResult(
                            'Basic DOM Manipulation',
                            'success'
                        );
                    }
                }
            }

            throw new Error('DOM manipulation test failed');

        } catch (error) {
            testResults.functionality = { status: 'error', error: error.message };
            logDebug(`‚ùå Functionality test failed: ${error.message}`);

            return createTestResult(
                'Basic Functionality',
                'error',
                error.message
            );
        }
    }

    // Run all tests
    async function runAllTests() {
        logDebug('üöÄ Starting Jex Framework Import Tests');

        // Test individual files
        const filesToTest = [
            { file: 'Jex.js', name: 'Jex.js (Core DOM Library)' },
            { file: 'JexLogger.js', name: 'JexLogger.js (Logging System)' },
            { file: 'JexToast.js', name: 'JexToast.js (Toast Notifications)' },
            { file: 'JexInspector.js', name: 'JexInspector.js (DOM Inspector)' },
            { file: 'JexApp.js', name: 'JexApp.js (Application Framework)' },
            { file: 'JexPackage.js', name: 'JexPackage.js (Unified Package)' }
        ];

        let fileTestsHTML = '';
        for (const { file, name } of filesToTest) {
            const result = await testFileImport(file, name);
            fileTestsHTML += result;
            updateOverallStatus();
            lucide.createIcons(); // Refresh icons
        }
        fileTests.innerHTML = fileTestsHTML;

        // Test package integration
        const packageResult = await testPackageIntegration();
        packageTest.innerHTML = packageResult;
        updateOverallStatus();
        lucide.createIcons();

        // Test functionality
        const functionalityResult = await testFunctionality();
        functionalityTest.innerHTML = functionalityResult;
        updateOverallStatus();
        lucide.createIcons();

        logDebug('üèÅ All tests completed');
    }

    // Start tests
    runAllTests().catch(error => {
        logDebug(`‚ùå Test runner failed: ${error.message}`);
        overallStatus.innerHTML = `‚ùå Test runner failed: ${error.message}`;
        overallStatus.className = 'p-4 rounded-lg bg-red-50 text-red-700';
    });
</script>
</body>
</html>