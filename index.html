<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes - Jex Framework</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="dark bg-dark-900 text-gray-100 min-h-screen">

<div class="max-w-2xl mx-auto px-6 py-8">

    <!-- Header -->
    <div class="text-center mb-8">
        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
            <i data-lucide="notebook-pen" class="w-6 h-6 text-white"></i>
        </div>
        <h1 class="text-2xl font-light text-gray-100">Notes</h1>
        <p class="text-sm text-gray-400 mt-1">Simple, elegant note taking</p>
    </div>

    <!-- Note Input -->
    <div class="bg-dark-800 rounded-2xl p-6 mb-8 border border-dark-700">
        <textarea
                id="noteInput"
                placeholder="What's on your mind?"
                class="w-full bg-transparent text-gray-100 placeholder-gray-500 resize-none border-0 outline-none text-lg leading-relaxed"
                rows="3"
        ></textarea>
        <div class="flex justify-between items-center mt-4 pt-4 border-t border-dark-700">
            <span id="charCount" class="text-xs text-gray-500">0 characters</span>
            <button
                    id="addNote"
                    class="px-6 py-2 bg-gradient-to-r from-purple-500 to-blue-600 text-white rounded-xl text-sm font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105"
            >
                Save Note
            </button>
        </div>
    </div>

    <!-- Notes List -->
    <div id="notesList" class="space-y-4">
        <!-- Notes will appear here -->
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="text-center py-16 text-gray-500">
        <div class="w-20 h-20 mx-auto mb-6 bg-dark-800 rounded-full flex items-center justify-center border border-dark-700">
            <i data-lucide="feather" class="w-10 h-10 text-gray-600"></i>
        </div>
        <p class="text-lg font-light mb-2 text-gray-400">No notes yet</p>
        <p class="text-sm text-gray-600">Your thoughts will appear here</p>
    </div>
</div>

<script type="module">
    /**
     * NotesApp.js - Minimal elegant note-taking app
     *
     * CLASS STRUCTURE:
     * ---------------
     * Private Fields:
     *   - #notes {Array}: Array of note objects
     *   - #noteCounter {number}: Auto-incrementing note ID
     *
     * Public Methods:
     *   - onInit(): Promise<void> - Setup the notes app
     *   - addNote(text: string): void - Add a new note
     *   - deleteNote(noteId: number): void - Delete a note
     *
     * Last Modified: 2025-09-16 - Minimal elegant implementation
     */

    const { JexApp } = await import('./JexApp.js');

    class NotesApp extends JexApp {
        #notes = [];
        #noteCounter = 1;

        constructor() {
            super({
                name: 'Notes',
                version: '1.0.0',
                enableKeyboardShortcuts: true
            });
        }

        async onInit() {
            this.#loadNotes();
            this.#setupEvents();
            this.#render();
        }

        onReady() {
            // Silent ready - no toast notification
            console.log('Notes app ready');
        }

        #setupEvents() {
            const input = this.jex.$('noteInput');
            const addBtn = this.jex.$('addNote');

            // Character counter
            input?.on('input', () => {
                const count = input.value().length;
                this.jex.$('charCount')?.text(`${count} characters`);

                // Enable/disable button
                if (count > 0) {
                    addBtn?.cls('-opacity-50').props('disabled', false);
                } else {
                    addBtn?.cls('+opacity-50').props('disabled', true);
                }
            });

            // Add note
            addBtn?.onClick(() => this.#handleAddNote());

            // Ctrl+Enter to save
            input?.on('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    this.#handleAddNote();
                }
            });
        }

        #handleAddNote() {
            const input = this.jex.$('noteInput');
            const text = input.value().trim();

            if (text) {
                this.addNote(text);
                input.value('');
                this.jex.$('charCount')?.text('0 characters');
                this.jex.$('addNote')?.cls('+opacity-50').props('disabled', true);
            }
        }

        addNote(text) {
            const note = {
                id: this.#noteCounter++,
                text: text,
                createdAt: new Date().toISOString()
            };

            this.#notes.unshift(note);
            this.#saveNotes();
            this.#render();
        }

        deleteNote(noteId) {
            this.#notes = this.#notes.filter(n => n.id !== noteId);
            this.#saveNotes();
            this.#render();
        }

        #render() {
            const notesList = this.jex.$('notesList');
            const emptyState = this.jex.$('emptyState');

            notesList.clear();

            if (this.#notes.length === 0) {
                emptyState.show();
            } else {
                emptyState.hide();
                this.#notes.forEach(note => {
                    const noteEl = this.#createNoteElement(note);
                    notesList.append(noteEl);
                });
            }
        }

        #createNoteElement(note) {
            const timeAgo = this.#getTimeAgo(note.createdAt);

            const noteEl = this.jex.create('div')
                .cls('bg-dark-800 rounded-2xl p-6 border border-dark-700 hover:border-dark-600 transition-all duration-200 group')
                .attr('data-note-id', note.id);

            // Note text
            noteEl.add('p')
                .cls('text-gray-100 leading-relaxed mb-4 whitespace-pre-wrap')
                .text(note.text);

            // Footer
            const footer = noteEl.add('div')
                .cls('flex justify-between items-center text-xs');

            footer.add('span')
                .cls('text-gray-500')
                .text(timeAgo);

            footer.add('button')
                .cls('text-gray-600 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100 p-1')
                .html('<i data-lucide="trash-2" class="w-4 h-4"></i>')
                .onClick(() => this.deleteNote(note.id));

            return noteEl;
        }

        #getTimeAgo(dateString) {
            const now = new Date();
            const date = new Date(dateString);
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        #saveNotes() {
            localStorage.setItem('jex-notes', JSON.stringify(this.#notes));
        }

        #loadNotes() {
            try {
                const saved = localStorage.getItem('jex-notes');
                if (saved) {
                    this.#notes = JSON.parse(saved);
                    const maxId = Math.max(0, ...this.#notes.map(n => n.id));
                    this.#noteCounter = maxId + 1;
                }
            } catch (error) {
                this.#notes = [];
            }
        }
    }

    // Launch app
    await NotesApp.launch(NotesApp);
    lucide.createIcons();
</script>

</body>
</html>